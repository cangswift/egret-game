var __reflect=this&&this.__reflect||function(e,t,a){e.__class__=t,a?a.push(t):a=[t],e.__types__=e.__types__?a.concat(e.__types__):a},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}(),BaseBtn=function(e){function t(t,a,i,r,n,o){var s=e.call(this)||this;return s.args=o,s.bitmap=t,s.touchEnabled=!0,s.init(a,i,r,n),s}return __extends(t,e),t.prototype.init=function(e,t,a,i){var r=GameData.stage.createBitmapByName(this.bitmap);this.addChild(r),r.width=e,r.height=t,r.x=a,r.y=i,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.removeEvent,this)},t.prototype["do"]=function(e){throw new egret.error},t.prototype.removeEvent=function(){this["do"](this.args),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.removeEvent,this)},t}(egret.Sprite);__reflect(BaseBtn.prototype,"BaseBtn");var HomeSceen=function(e){function t(){var t=e.call(this)||this;return t.init(),t}return __extends(t,e),t.prototype.init=function(){var e=new egret.Bitmap;e.texture=RES.getRes("homebg_png"),e.width=GameData.stageW,e.height=GameData.stageH,this.addChild(e);var t=new HomeBtnsView;this.addChild(t)},t}(egret.Sprite);__reflect(HomeSceen.prototype,"HomeSceen");var Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isThemeLoadEnd=!1,t.isResourceLoadEnd=!1,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},t.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},t.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.startCreateScene=function(){GameData.stage=this,LocalStorageControl.initData(),SceenControl.loadHome()},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,a=RES.getRes(e);return t.texture=a,t},t.prototype.startAnimation=function(e){var t=this,a=new egret.HtmlTextParser,i=e.map(function(e){return a.parse(e)}),r=this.textfield,n=-1,o=function(){n++,n>=i.length&&(n=0);var e=i[n];r.textFlow=e;var a=egret.Tween.get(r);a.to({alpha:1},200),a.wait(2e3),a.to({alpha:0},200),a.call(o,t)};o()},t}(eui.UILayer);__reflect(Main.prototype,"Main");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,a,i){function r(e){t.call(i,e)}function n(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),a.call(i))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var ChapterConfig=function(){function e(){}return e.getData=function(e){var t=RES.getRes("chapterMap_json");return t[e]},e.getChapterNum=function(){var e=RES.getRes("chapterMap_json");return Object.keys(e).length},e}();__reflect(ChapterConfig.prototype,"ChapterConfig");var ColorGlowFilter=function(){function e(){}return e.transparentGF=new egret.GlowFilter(16777215,0,6,6,20,1),e.whiteGF=new egret.GlowFilter(16777215,1,6,6,20,1),e.redGF=new egret.GlowFilter(14423100,1,6,6,20,1),e.blueGF=new egret.GlowFilter(49151,1,6,6,20,1),e.yellowGF=new egret.GlowFilter(14410244,1,6,6,20,1),e}();__reflect(ColorGlowFilter.prototype,"ColorGlowFilter");var ConnectLogic=function(){function e(){}return e.isSameType=function(e,t){return e.type==t.type},e.onLineX=function(e,t){return e.locationY==t.locationY?!0:!1},e.onLineY=function(e,t){return e.locationX==t.locationX?!0:!1},e.equalsElement=function(e,t){return e==t?!0:!1},e.isEmpty=function(e){return!GameData.mapData[e]},e.clear=function(e,t){GameData.mapData[e.id]=0,GameData.mapData[t.id]=0},e.hasLine=function(e,t){if(this.equalsElement(e,t))return!1;if(this.onLineX(e,t)){var a=(e.locationX>t.locationX?t.id:e.id)+1,i=e.locationX>t.locationX?e.id:t.id,r=void 0;for(r=0;i-a>r&&this.isEmpty(a+r);r++);return r==i-a?!0:!1}if(this.onLineY(e,t)){var a=(e.locationY>t.locationY?t.id:e.id)+GameData.maxRow,i=e.locationY>t.locationY?e.id:t.id,r=void 0;for(r=0;r<(i-a)/GameData.maxRow&&this.isEmpty(a+r*GameData.maxRow);r++);return r==(i-a)/GameData.maxRow?!0:!1}return!1},e.drawLine=function(e){var t=new egret.Sprite,a=GameData.elementViews[e[0].id].x-.5*GameData.elementWidth,i=GameData.elementViews[e[0].id].y-.5*GameData.elementWidth;t.graphics.lineStyle(5,49151),t.graphics.moveTo(a,i);for(var r=1;r<e.length;r++){var n=GameData.elementViews[e[r].id].x-.5*GameData.elementWidth,o=GameData.elementViews[e[r].id].y-.5*GameData.elementWidth;t.graphics.lineTo(n,o)}GameData.drawLineSprite.addChild(t)},e.isPassToLined=function(e,t){return(this.onLineY(e,t)||this.onLineX(e,t))&&this.hasLine(e,t)?[e,t]:[]},e.isCloseElement=function(e,t){var a=e.id,i=t.id;return(this.isEmpty(a+1)||this.isEmpty(a-1)||this.isEmpty(a+GameData.maxRow)||this.isEmpty(a-GameData.maxRow))&&(this.isEmpty(i+1)||this.isEmpty(i-1)||this.isEmpty(i+GameData.maxRow)||this.isEmpty(i-GameData.maxRow))?!1:!0},e.isPassFromUpOrDown=function(e,t){var a,i,r,n;e.id,t.id;if(this.onLineX(e,t)){for(var o=e.locationY+1,s=0;o>s;s++)if(a=e,i=GameData.elements[e.id-s*GameData.maxRow],r=GameData.elements[t.id-s*GameData.maxRow],n=t,this.isEmpty(i.id)&&this.isEmpty(r.id)&&this.hasLine(a,i)&&this.hasLine(i,r)&&this.hasLine(r,n))return[a,i,r,n];for(var h=GameData.maxRow-e.locationY,s=0;h>s;s++)if(a=e,i=GameData.elements[e.id+s*GameData.maxRow],r=GameData.elements[t.id+s*GameData.maxRow],n=t,this.isEmpty(i.id)&&this.isEmpty(r.id)&&this.hasLine(a,i)&&this.hasLine(i,r)&&this.hasLine(r,n))return[a,i,r,n]}var l=e.locationX+1;if(this.onLineY(e,t))for(var s=0;l>s;s++)if(a=e,i=GameData.elements[e.id-s],r=GameData.elements[t.id-s],n=t,this.isEmpty(i.id)&&this.isEmpty(r.id)&&this.hasLine(a,i)&&this.hasLine(i,r)&&this.hasLine(r,n))return[a,i,r,n];for(var p=GameData.maxRow-e.locationX,s=0;p>s;s++)if(a=e,i=GameData.elements[e.id+s],r=GameData.elements[t.id+s],n=t,this.isEmpty(i.id)&&this.isEmpty(r.id)&&this.hasLine(a,i)&&this.hasLine(i,r)&&this.hasLine(r,n))return[a,i,r,n];return[]},e.isPassIrregular=function(e,t){for(var a,i,r,n,o=(e.id,t.id,e.locationX>t.locationX?e.locationX:t.locationX),s=e.locationY>t.locationY?e.locationY:t.locationY,h=s;h>0;h--)if(a=e,i=GameData.elements[e.locationX+h*GameData.maxRow],r=GameData.elements[t.locationX+h*GameData.maxRow],n=t,this.equalsElement(a,i)){if(!this.isEmpty(r.id))continue;if(this.hasLine(i,r)&&this.hasLine(r,n))return[i,r,n]}else if(this.equalsElement(r,n)){if(!this.isEmpty(i.id))continue;if(this.hasLine(a,i)&&this.hasLine(i,r))return[a,i,r]}else if(this.isEmpty(i.id)&&this.isEmpty(r.id)&&this.hasLine(a,i)&&this.hasLine(i,r)&&this.hasLine(r,n))return[a,i,r,n];for(var h=s;h<GameData.maxRow-1;h++)if(a=e,i=GameData.elements[e.locationX+h*GameData.maxRow],r=GameData.elements[t.locationX+h*GameData.maxRow],n=t,this.equalsElement(a,i)){if(!this.isEmpty(r.id))continue;if(this.hasLine(i,r)&&this.hasLine(r,n))return[i,r,n]}else if(this.equalsElement(r,n)){if(!this.isEmpty(i.id))continue;if(this.hasLine(a,i)&&this.hasLine(i,r))return[a,i,r]}else if(this.isEmpty(i.id)&&this.isEmpty(r.id)&&this.hasLine(a,i)&&this.hasLine(i,r)&&this.hasLine(r,n))return[a,i,r,n];for(var h=0;o>h;h++){if(a=e,i=GameData.elements[e.locationY*GameData.maxRow+h],r=GameData.elements[t.locationY*GameData.maxRow+h],n=t,this.equalsElement(a,i)){if(!this.isEmpty(r.id))continue;if(this.hasLine(i,r)&&this.hasLine(r,n))return[i,r,n]}if(this.equalsElement(r,n)){if(!this.isEmpty(i.id))continue;if(this.hasLine(a,i)&&this.hasLine(i,r))return[a,i,r]}if(this.isEmpty(i.id)&&this.isEmpty(r.id)&&this.hasLine(a,i)&&this.hasLine(i,r)&&this.hasLine(r,n))return[a,i,r,n]}for(var h=o;h<GameData.maxRow-1;h++){if(a=e,i=GameData.elements[e.locationY*GameData.maxRow+h],r=GameData.elements[t.locationY*GameData.maxRow+h],n=t,this.equalsElement(a,i)){if(!this.isEmpty(r.id))continue;if(this.hasLine(i,r)&&this.hasLine(r,n))return[i,r,n]}if(this.equalsElement(r,n)){if(!this.isEmpty(i.id))continue;if(this.hasLine(a,i)&&this.hasLine(i,r))return[a,i,r]}if(this.isEmpty(i.id)&&this.isEmpty(r.id)&&this.hasLine(a,i)&&this.hasLine(i,r)&&this.hasLine(r,n))return[a,i,r,n]}return[]},e.isAlive=function(e){return GameData.mapData[e.id]},e.getPath=function(e,t,a){if(void 0===a&&(a=!0),!this.isSameType(e,t))return!1;if(!this.isAlive(e)||!this.isAlive(t))return!1;var i=e;e.locationX>t.locationX?(e=t,t=i):e.locationX==t.locationX&&e.locationY>t.locationY&&(e=t,t=i);var r=this.isPassToLined(e,t);if(r.length)return a&&this.drawLine(r),!0;var n=this.isCloseElement(e,t);if(n)return!1;var o=this.isPassFromUpOrDown(e,t);if(o.length)return a&&this.drawLine(o),!0;var s=this.isPassIrregular(e,t);return s.length?(a&&this.drawLine(s),!0):!1},e.prompt=function(e,t){for(var a=(GameData.eleParentSprite,GameData.elements.length),i=GameData.elements,r=function(r){if(!GameData.mapData[r])return"continue";for(var o=i[r],s=function(a){if(!GameData.mapData[a])return"continue";var r=i[a];return o==r?"continue":o.type==r.type&&n.getPath(o,r,t)?(e&&(n.clear(o,r),setTimeout(function(){GameData.drawLineSprite.removeChildren(),GameData.elementViews[o.id].removAnimate(),GameData.elementViews[r.id].removAnimate()},TimerData.eleDisappearTime)),{value:!0}):void 0},h=r+1;a>h;h++){var l=s(h);if("object"==typeof l)return l}},n=this,o=0;a>o;o++){var s=r(o);if("object"==typeof s)return s.value}return!1},e}();__reflect(ConnectLogic.prototype,"ConnectLogic");var GameEventManager=function(){function e(){}return e.timeout=function(){egret.log("时间到")},e}();__reflect(GameEventManager.prototype,"GameEventManager");var LocalStorageControl=function(){function e(){}return e.initData=function(){egret.localStorage.clear(),egret.localStorage.setItem("icon",InitConfigData.icon.toString()),egret.localStorage.setItem("chapter",InitConfigData.chapter.toString()),egret.localStorage.setItem("prompt",InitConfigData.prompt.toString()),egret.localStorage.setItem("pause",InitConfigData.pause.toString()),egret.localStorage.setItem("reset",InitConfigData.reset.toString()),egret.localStorage.setItem("isInited","1")},e.openChapter=function(){var e=Number(egret.localStorage.getItem("chapter"));100>e&&egret.localStorage.setItem("chapter",(e+1).toString())},e.getChapter=function(){return Number(egret.localStorage.getItem("chapter"))},e.addIcon=function(e){var t=Number(egret.localStorage.getItem("icon"));egret.localStorage.setItem("icon",(t+e).toString())},e.useIcon=function(e){var t=Number(egret.localStorage.getItem("icon"));egret.localStorage.setItem("icon",(t-e).toString())},e.getIcon=function(){return Number(egret.localStorage.getItem("icon"))},e.isInited=function(){return!!egret.localStorage.getItem("isInited")},e.getPropsItemNum=function(e){return Number(egret.localStorage.getItem(e))},e.addPropsItemNum=function(e){var t=Number(egret.localStorage.getItem(e))+1;egret.localStorage.setItem(e,t.toString())},e.usePropsItemNum=function(e){var t=Number(egret.localStorage.getItem(e))-1;egret.localStorage.setItem(e,t.toString())},e}();__reflect(LocalStorageControl.prototype,"LocalStorageControl");var PropsManager=function(){function e(){}return e.userProps=function(e){switch(e){case 0:this.promptProps();break;case 1:this.stopTimeProps();break;case 2:this.resetMap()}},e.promptProps=function(){GameData.gameMap.isReady&&ConnectLogic.prompt(!0,!0)&&(GameData.promptNum--,GameData.gameMap.checkCanLine())},e.stopTimeProps=function(){GameData.timerManager.pause()},e.resetMap=function(){GameData.gameMap.createAllElement()},e}();__reflect(PropsManager.prototype,"PropsManager");var SceenControl=function(){function e(){}return e.loadHome=function(){this.load(new HomeSceen)},e.loadChapter=function(){this.load(new ChapterSceen)},e.loadGame=function(e){this.load(new GameSceen(e))},e.loadStore=function(){this.load(new StoreSceen)},e.load=function(e){GameData.stage.removeChildren();var t=e;GameData.sceen=t,GameData.stage.addChild(t)},e}();__reflect(SceenControl.prototype,"SceenControl");var GameData=function(){function e(){}return e.resetData=function(){this.elements=new Array,this.elementViews=new Array,this.mapData=new Array},e.maxRow=10,e.maxColumn=10,e.stageW=640,e.stageH=1136,e.elementWidth=600/e.maxColumn,e.elementTypes=["e0_png","e1_png","e2_png","e3_png","e4_png","e5_png"],e.promptNum=0,e.level=1,e.backgroundImage="defaultBg_png",e}();__reflect(GameData.prototype,"GameData");var InitConfigData=function(){function e(){}return e.icon=1e3,e.chapter=0,e.prompt=3,e.pause=3,e.reset=3,e}();__reflect(InitConfigData.prototype,"InitConfigData");var PropsPrice=function(){function e(){}return e.prompt=500,e.reset=500,e.pause=500,e}();__reflect(PropsPrice.prototype,"PropsPrice");var TimerData=function(){function e(){}return e.time=90,e.pauseTime=5,e.eleDisappearTime=200,e}();__reflect(TimerData.prototype,"TimerData");var BasePropsElements=function(e){function t(t,a,i){var r=e.call(this)||this;return r.touchEnabled=!0,r.propsId=t,r.texture=a,r.girdSize=i,r.init(),r}return __extends(t,e),t.prototype.init=function(){this.createProps()},t.prototype.createProps=function(){var e=new egret.Bitmap;e.texture=RES.getRes(this.texture),e.width=this.girdSize,e.height=this.girdSize,this.addChild(e);var t=new egret.TextField;t.textColor=16777215,t.size=40,t.width=this.girdSize-20,t.height=60,t.textAlign="right",t.verticalAlign="middle",t.text=LocalStorageControl.getPropsItemNum(this.texture.slice(0,this.texture.length-4)).toString(),this.addChild(t),this.numText=t,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.propsTap,this)},t.prototype.updatePropsNum=function(){console.log("update"),this.removeChild(this.numText);var e=new egret.TextField;e.textColor=16777215,e.size=40,e.width=this.girdSize-20,e.height=60,e.textAlign="right",e.verticalAlign="middle",e.text=LocalStorageControl.getPropsItemNum(this.texture.slice(0,this.texture.length-4)).toString(),this.addChild(e),this.numText=e},t.prototype.propsTap=function(e){var t=this.texture.slice(0,this.texture.length-4);LocalStorageControl.getPropsItemNum(t)&&(LocalStorageControl.usePropsItemNum(t),this.updatePropsNum(),PropsManager.userProps(this.propsId))},t}(egret.Sprite);__reflect(BasePropsElements.prototype,"BasePropsElements");var GameElement=function(e){function t(t,a){var i=e.call(this)||this;return i.type="",i.id=t,i.type=a,i.locationX=t%GameData.maxRow,i.locationY=Math.floor(t/GameData.maxRow),i}return __extends(t,e),t.prototype.update=function(e){this.id=e,this.locationX=e%GameData.maxRow,this.locationY=Math.floor(e/GameData.maxRow)},t}(egret.Sprite);__reflect(GameElement.prototype,"GameElement");var GameEvent=function(e){function t(t,a,i){void 0===a&&(a=!1),void 0===i&&(i=!1);var r=e.call(this,t,a,i)||this;return r.propToElementLocation=0,r.ele1=0,r.ele2=0,r}return __extends(t,e),t.TAP_TWO_ELEMENT="tap_two_element",t.REMOVE_ANIMATION_OVER="remove_animation_over",t.UPDATE_MAP="update_map",t.UPDATE_VIEW_OVER="update_view_over",t.USE_PROP_CLICK="use_prop_click",t.TIME_OUT="time_out",t}(egret.Event);__reflect(GameEvent.prototype,"GameEvent");var ChapterSceen=function(e){function t(){var t=e.call(this)||this;return t.touchEnabled=!0,t.touchChildren=!0,t.init(),t}return __extends(t,e),t.prototype.init=function(){var e=GameData.stage.createBitmapByName("chapter_sceen_jpg");e.width=GameData.stageW,e.height=GameData.stageH,this.addChild(e);var t=new egret.ScrollView;t.width=GameData.stageW,t.height=GameData.stageH-200,t.y=100,this.addChild(t);var a=this.createElements();t.setContent(a),t.touchEnabled=!0,t.touchChildren=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this["do"],this);var i=new BackBtn("back_btn_png",225,80,GameData.stageW-250,20,"Home");this.addChild(i)},t.prototype["do"]=function(e){var t=e.target;"unlock"==t.type&&SceenControl.loadGame(t.id)},t.prototype.createElements=function(){for(var e,t=ChapterConfig.getChapterNum(),a=Math.ceil(t/3),i=3,r=new egret.Sprite,n=(GameData.stageW-160)/3,o=0;a>o;o++)for(var s=0;i>s;s++){var h=o*a+s;if(o*i+s==t)return r;e=h<=LocalStorageControl.getChapter()?new UnLockChapter(h,n,n):new LockChapter(h,n,n),e.x=40+s*(e.width+40),e.y=150+o*(e.width+40),r.addChild(e)}r.touchEnabled=!0,r.touchChildren=!0},t}(egret.Sprite);__reflect(ChapterSceen.prototype,"ChapterSceen");var GameSceen=function(e){function t(t){var a=e.call(this)||this;return a.chapter=t,a.init(),a}return __extends(t,e),t.prototype.init=function(){var e=new GameBackground(this.chapter,this);this.addChild(e),this.gm=new GameMap(this),GameData.gameMap=this.gm,this.addChild(this.gm),this.pv=new PropViews,this.addChild(this.pv);var t=new BackBtn("back_btn_png",120,60,GameData.stageW-140,20,"Chapter");this.addChild(t)},t.prototype.showResult=function(e){e?(LocalStorageControl.addIcon(100+10*this.chapter),LocalStorageControl.openChapter()):LocalStorageControl.addIcon(50),this.gm.touchChildren=!1,this.pv.touchChildren=!1;var t=new ResultView(e);this.addChild(t)},t}(egret.Sprite);__reflect(GameSceen.prototype,"GameSceen");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var StoreSceen=function(e){function t(){var t=e.call(this)||this;return t.init(),t}return __extends(t,e),t.prototype.init=function(){var e=GameData.stage.createBitmapByName("store_png");e.width=GameData.stageW,e.height=GameData.stageH,this.addChild(e);var t=new IconView;this.addChild(t);var a=new BackBtn("back_btn_png",120,60,GameData.stageW-140,20,"Home");this.addChild(a);var i=new PropsShopItem("prompt_png","prompt",300,"快速提示");this.addChild(i);var r=new PropsShopItem("pause_png","pause",450,"时间暂停");this.addChild(r);var n=new PropsShopItem("reset_png","reset",600,"重新整理");this.addChild(n)},t}(egret.Sprite);__reflect(StoreSceen.prototype,"StoreSceen");var BuyFailView=function(e){function t(t){var a=e.call(this)||this;return a.thisparent=t,a.init(),a}return __extends(t,e),t.prototype.init=function(){var e=this,t=GameData.stage.createBitmapByName("buy_fail_png");this.addChild(t),t.width=530,t.height=335,t.x=(GameData.stageW-530)/2,t.y=(GameData.stageH-335)/2;setTimeout(function(){e.parent&&e.thisparent.removeChild(e)},1e3)},t}(egret.Sprite);__reflect(BuyFailView.prototype,"BuyFailView");var ElementView=function(e){function t(t,a,i){var r=e.call(this)||this;return r.duration=3e3,r.speed=1e3,r.elePadding=5,r.thisParent=t,r.id=a,r.init(i,a),r}return __extends(t,e),t.prototype.init=function(e,t){this.touchEnabled=!0,this.touchChildren=!1,this.bitmap=new egret.Bitmap,this.bitmap.width=GameData.elementWidth-10,this.bitmap.height=GameData.elementWidth-10,this.bitmap.texture=RES.getRes(e),this.bitmap.x=-1*GameData.elementWidth,this.bitmap.y=-1*GameData.elementWidth},t.prototype.show=function(){var e=50*GameData.maxColumn*GameData.maxRow-50*(GameData.elements[this.id].locationX+GameData.maxRow*GameData.elements[this.id].locationY),t=egret.Tween.get(this);t.wait(e,!1),t.call(this.addThisToParent,this),t.to({x:this.targetX(),y:this.targetY()},this.speed,egret.Ease.bounceOut),this.filters=[ColorGlowFilter.transparentGF]},t.prototype.addThisToParent=function(){this.addChild(this.bitmap)},t.prototype.targetX=function(){var e=GameData.elementWidth,t=20+e*(this.id%GameData.maxRow)+1*e+this.elePadding;return t},t.prototype.targetY=function(){var e=GameData.elementWidth,t=0,a=e*Math.floor(this.id/GameData.maxColumn)+1*e+this.elePadding,i=t+a;return i},t.prototype.onFocusing=function(){this.filters=[ColorGlowFilter.yellowGF]},t.prototype.onBluring=function(){this.filters=[ColorGlowFilter.transparentGF]},t.prototype.removAnimate=function(){this.onBluring();var e=egret.Tween.get(this);e.to({scaleX:1.4,scaleY:1.4},300,egret.Ease.cubicInOut).to({scaleX:.1,scaleY:.1},300,egret.Ease.cubicInOut).call(this.removeAniCall,this)},t.prototype.prompting=function(){this.filters=[ColorGlowFilter.blueGF]},t.prototype.removeAniCall=function(){this.thisParent&&this.thisParent.removeChild(this)},t}(egret.Sprite);__reflect(ElementView.prototype,"ElementView");var GameBackground=function(e){function t(t,a){var i=e.call(this)||this;return i.chapter=t,i.thisparent=a,i.changeBackground(),i}return __extends(t,e),t.prototype.changeBackground=function(){this.cacheAsBitmap=!1,this.removeChildren(),this.createBackgroundImage(),this.createLevelImage(),this.createTimerImage(),this.createIconView(),this.cacheAsBitmap=!0},t.prototype.createBackgroundImage=function(){var e=ChapterConfig.getData(this.chapter).background,t=new egret.Bitmap;t.width=GameData.stageW,t.height=GameData.stageH,t.texture=RES.getRes(e),this.addChild(t)},t.prototype.createLevelImage=function(){var e=new egret.TextField;e.textColor=16777215,e.size=40,e.width=GameData.stageW,e.height=80,e.textAlign="center",e.verticalAlign="middle",e.text=(this.chapter+1).toString(),this.addChild(e)},t.prototype.createTimerImage=function(){var e=new TimerView(1e3,TimerData.time,this.thisparent);GameData.timerManager=e,this.addChild(e),e.x=20,e.y=160},t.prototype.createIconView=function(){var e=new egret.TextField;e.textColor=16776960,e.size=40,e.width=260,e.height=110,e.textAlign="center",e.verticalAlign="middle",e.text=LocalStorageControl.getIcon().toString(),this.addChild(e)},t}(egret.Sprite);__reflect(GameBackground.prototype,"GameBackground");var GameMap=function(e){function t(t){var a=e.call(this)||this;return a.isReady=!1,a.thisParent=t,a.init(),a}return __extends(t,e),t.prototype.init=function(){this.createBottomSprite(),this.createAllElement()},t.prototype.createBottomSprite=function(){var e=new egret.Sprite;this.addChild(e),GameData.drawLineSprite=e;var t=new egret.Sprite;this.addChild(t),GameData.eleParentSprite=t},t.prototype.createAllElement=function(){var e=this;this.touchChildren=!1,this.isReady=!1,GameData.timerManager.reset(),GameData.eleParentSprite.removeChildren(),GameData.drawLineSprite.removeChildren(),GameData.elementViews=new Array,GameData.mapData=new Array,GameData.elements=new Array;for(var t=new Array,a=GameData.elementTypes,i=(GameData.elementWidth,(GameData.maxRow-2)*(GameData.maxColumn-2)),r=0;i>r;r++)if(r>0&&r%2==1){var n=a[Math.floor(Math.random()*a.length)],o=new GameElement(r-1,n),s=new GameElement(r,n);t.push(o),t.push(s)}t=t.sort(function(){return.5-Math.random()});for(var r=0;r<GameData.maxRow;r++)for(var h=0;h<GameData.maxColumn;h++){var l=r+GameData.maxRow*h;0==r||0==h||r==GameData.maxRow-1||h==GameData.maxColumn-1?GameData.elements[l]=new GameElement(l,a[0]):GameData.elements[l]=t.shift()}for(var r=(GameData.elementWidth,0);r<GameData.maxRow;r++)for(var h=0;h<GameData.maxColumn;h++){var l=r+GameData.maxRow*h,p=GameData.elements[l];p.update(l);var c=new ElementView(GameData.eleParentSprite,l,p.type);c.addEventListener(egret.TouchEvent.TOUCH_TAP,this.eventManger,this),c.x=c.targetX(),c.show(),GameData.elementViews[l]=c,0==r||0==h||r==GameData.maxRow-1||h==GameData.maxColumn-1||this.isEmptyElement(l)?GameData.mapData[l]=0:(GameData.mapData[l]=1,GameData.eleParentSprite.addChild(c))}this.y=150;var m=setTimeout(function(){return GameData.gameMap!=e&&GameData.sceen!=e?clearTimeout(m):(e.touchChildren=!0,e.isReady=!0,void GameData.timerManager.start())},GameData.maxRow*GameData.maxColumn*50)},t.prototype.isEmptyElement=function(e){var t=ChapterConfig.getData(1).emptyElement;return-1!=t.indexOf(e)?!0:!1},t.prototype.eventManger=function(e){var t=this;if(GameData.drawLineSprite.removeChildren(),this.tap1){this.tap2=e.target;var a=GameData.elements[this.tap1.id],i=GameData.elements[this.tap2.id];if(this.tap2.onFocusing(),ConnectLogic.getPath(a,i))var r=setTimeout(function(){return GameData.gameMap!=t&&GameData.sceen!=t?clearTimeout(r):void t.clearElement(t.tap1,t.tap2)},TimerData.eleDisappearTime);else this.tap1.onBluring(),this.tap1=this.tap2,this.tap2=null,this.tap1.onFocusing()}else this.tap1=e.target,this.tap1.onFocusing()},t.prototype.clearElement=function(e,t){ConnectLogic.clear(e,t),GameData.drawLineSprite.removeChildren(),t.removAnimate(),e.removAnimate(),this.tap1=null,this.tap2=null,this.checkCanLine()},t.prototype.checkCanLine=function(){ConnectLogic.prompt(!1,!1)||(GameData.timerManager.stop(),this.pass())},t.prototype.timeout=function(){GameData.eleParentSprite.numChildren?this.lose():this.pass()},t.prototype.pass=function(){egret.log("过关"),this.thisParent.showResult(!0)},t.prototype.lose=function(){egret.log("失败"),this.thisParent.showResult(!1)},t}(egret.Sprite);__reflect(GameMap.prototype,"GameMap");var HomeBtnsView=function(e){function t(){var t=e.call(this)||this;return t.touchChildren=!0,t.init(),t}return __extends(t,e),t.prototype.init=function(){this.createChapter(),this.createStore()},t.prototype.createChapter=function(){var e=new EnterChapterBtn("startbtn_png",225,85,230,255,null);this.addChild(e)},t.prototype.createStore=function(){var e=new EnterStoreBtn("storebtn_png",225,85,230,400,null);this.addChild(e)},t}(egret.Sprite);__reflect(HomeBtnsView.prototype,"HomeBtnsView");var IconView=function(e){function t(){var t=e.call(this)||this;return t.createIconView(),t}return __extends(t,e),t.prototype.createIconView=function(){var e=new egret.TextField;e.textColor=16776960,e.size=40,e.width=260,e.height=110,e.textAlign="center",e.verticalAlign="middle",e.text=LocalStorageControl.getIcon().toString(),this.addChild(e)},t}(egret.Sprite);__reflect(IconView.prototype,"IconView");var LockChapter=function(e){function t(t,a,i){var r=e.call(this)||this;return r.type="lock",r.touchEnabled=!0,r.id=t,r.init(a,i),r}return __extends(t,e),t.prototype.init=function(e,t){var a=GameData.stage.createBitmapByName("cadeado_png");a.width=e,a.height=t,this.addChild(a)},t}(egret.Sprite);__reflect(LockChapter.prototype,"LockChapter");var LoseView=function(e){function t(){var t=e.call(this)||this;return t.touchEnabled=!0,t.init(),t}return __extends(t,e),t.prototype.init=function(){this.createView()},t.prototype.createView=function(){var e=new egret.Bitmap;e.width=GameData.stageW,e.height=GameData.stageH,e.texture=RES.getRes("lose_png"),this.addChild(e),this.createBtnView()},t.prototype.createBtnView=function(){var e=new BackBtn("exit_png",200,100,100,GameData.stageH-400,"Chapter");this.addChild(e);var t=new BackBtn("again_png",200,100,300,GameData.stageH-400,"Game");this.addChild(t)},t}(egret.Sprite);__reflect(LoseView.prototype,"LoseView");var PassView=function(e){function t(){var t=e.call(this)||this;return t.touchEnabled=!0,t.init(),t}return __extends(t,e),t.prototype.init=function(){this.createView()},t.prototype.createView=function(){var e=new egret.Bitmap;e.texture=RES.getRes("win_png"),e.height=GameData.stageH,e.width=GameData.stageW,this.addChild(e),this.createBtnView()},t.prototype.createBtnView=function(){var e=new BackBtn("exit_png",200,100,100,GameData.stageH-400,"Chapter");this.addChild(e);var t=new BackBtn("next_png",200,100,300,GameData.stageH-400,"Game");this.addChild(t)},t}(egret.Sprite);__reflect(PassView.prototype,"PassView");var PropsShopItem=function(e){function t(t,a,i,r){var n=e.call(this)||this;return n.type=a,n.createView(t,i,r),n}return __extends(t,e),t.prototype.createView=function(e,t,a){var i=GameData.stage.createBitmapByName(e);this.addChild(i),i.width=100,i.height=100,i.x=100,i.y=t;var r=new egret.TextField;r.fontFamily="Arial",r.textColor=16777215,r.size=30,r.bold=!0,r.text=PropsPrice.prompt.toString(),this.addChild(r),r.x=250,r.y=t+10;var n=new egret.TextField;n.fontFamily="Arial",n.textColor=16777215,n.bold=!0,n.size=30,n.text=a,this.addChild(n),n.x=250,n.y=t+60;var o=new egret.TextField;o.fontFamily="Arial",o.textColor=16777215,o.bold=!0,o.size=30,o.text=LocalStorageControl.getPropsItemNum(this.type).toString(),this.addChild(o),o.x=400,o.y=t+20;var s=new BuyBtn(this.type);this.addChild(s),s.width=200,s.height=70,s.x=470,s.y=t+20},t}(egret.Sprite);__reflect(PropsShopItem.prototype,"PropsShopItem");var PropViews=function(e){function t(){var t=e.call(this)||this;return t.init(),t}return __extends(t,e),t.prototype.init=function(){this.createProps()},t.prototype.createProps=function(){var e=(GameData.stageW-160)/3,t=new BasePropsElements(0,"prompt_png",e);t.y=GameData.stageH-e-30,t.x=40,this.addChild(t);var a=new BasePropsElements(1,"pause_png",e);a.y=GameData.stageH-e-30,a.x=80+e,this.addChild(a);var i=new BasePropsElements(2,"reset_png",e);i.y=GameData.stageH-e-30,i.x=120+2*e,this.addChild(i)},t}(egret.Sprite);__reflect(PropViews.prototype,"PropViews");var ResultView=function(e){function t(t){var a=e.call(this)||this;return a.init(t),a}return __extends(t,e),t.prototype.init=function(e){this.createView(e)},t.prototype.createView=function(e){var t;t=e?new PassView:new LoseView,this.addChild(t)},t.prototype.update=function(){},t}(egret.Sprite);__reflect(ResultView.prototype,"ResultView");var TimerView=function(e){function t(t,a,i){var r=e.call(this)||this;return r.pauseTimer=null,r.timer=new egret.Timer(t,a),r.listener=i,r.init(),r}return __extends(t,e),t.prototype.init=function(){this.createTimerImage()},t.prototype.createTimerImage=function(){var e=new egret.Bitmap;e.texture=RES.getRes("timer_png"),e.width=114,e.height=45,this.addChild(e),this.timerNumberSp=new egret.Sprite,this.timerNumberSp.width=114,this.timerNumberSp.height=45,this.addChild(this.timerNumberSp),this.update()},t.prototype.update=function(){this.timerNumberSp.removeChildren();var e=this.timer.repeatCount-this.timer.currentCount,t=new egret.TextField;t.textColor=16777215,t.size=30,t.width=115,t.height=45,t.textAlign="center",t.verticalAlign="middle",t.text=e.toString(),this.timerNumberSp.addChild(t)},t.prototype["do"]=function(){this.update()},t.prototype.complete=function(){this.timer.removeEventListener(egret.TimerEvent.TIMER,this["do"],this),this.timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.complete,this),GameData.sceen==this.listener&&GameData.gameMap.timeout()
},t.prototype.start=function(){this.timer.start(),this.timer.addEventListener(egret.TimerEvent.TIMER,this["do"],this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.complete,this)},t.prototype.stop=function(){this.timer.stop()},t.prototype.pause=function(){var e=this;return this.pauseTimer?(LocalStorageControl.addPropsItemNum("pause"),!1):(this.timer.stop(),void(this.pauseTimer=setTimeout(function(){return e.pauseTimer=null,GameData.sceen!=e.listener?clearTimeout(e.pauseTimer):e.timer?e.timer.start():void 0},1e3*TimerData.pauseTime)))},t.prototype.reset=function(){this.timer.reset()},t.prototype.running=function(){return this.timer.running},t}(egret.Sprite);__reflect(TimerView.prototype,"TimerView");var UnLockChapter=function(e){function t(t,a,i){var r=e.call(this)||this;return r.type="unlock",r.touchEnabled=!0,r.id=t,r.init(a,i),r}return __extends(t,e),t.prototype.init=function(e,t){var a=GameData.stage.createBitmapByName("unlock_png");a.width=e,a.height=t,this.addChild(a);var i=new egret.TextField;i.textColor=16777215,i.size=40,i.bold=!0,i.stroke=2,i.width=e,i.height=t,i.strokeColor=0,i.textAlign="center",i.verticalAlign="middle",i.text=this.id.toString(),this.addChild(i)},t}(egret.Sprite);__reflect(UnLockChapter.prototype,"UnLockChapter");var BackBtn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype["do"]=function(e){switch(e){case"Home":SceenControl.loadHome();break;case"Chapter":SceenControl.loadChapter();break;case"Game":SceenControl.loadGame(LocalStorageControl.getChapter())}},t}(BaseBtn);__reflect(BackBtn.prototype,"BackBtn");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,a){function i(i){t.call(a,i,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?i(r):RES.getResAsync(e,i,this)}else RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var BuyBtn=function(e){function t(t){var a=e.call(this)||this;return a.touchEnabled=!0,a.type=t,a.init(),a}return __extends(t,e),t.prototype.init=function(){var e=GameData.stage.createBitmapByName("buy_png");this.addChild(e),e.width=100,e.height=50,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this["do"],this)},t.prototype["do"]=function(){if(this.checkIcon())LocalStorageControl.addPropsItemNum(this.type),LocalStorageControl.useIcon(PropsPrice[this.type]),SceenControl.loadStore();else{var e=new BuyFailView(GameData.sceen);GameData.sceen.addChild(e)}},t.prototype.checkIcon=function(){return LocalStorageControl.getIcon()>=PropsPrice[this.type]},t}(egret.Sprite);__reflect(BuyBtn.prototype,"BuyBtn");var EnterChapterBtn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype["do"]=function(){SceenControl.loadChapter()},t}(BaseBtn);__reflect(EnterChapterBtn.prototype,"EnterChapterBtn");var EnterStoreBtn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype["do"]=function(){SceenControl.loadStore()},t}(BaseBtn);__reflect(EnterStoreBtn.prototype,"EnterStoreBtn");